# Playbook: Vulnerability Exploitation

**ID**: PB-18
**Severity**: High/Critical | **Category**: Vulnerability Management
**MITRE ATT&CK**: [T1190](https://attack.mitre.org/techniques/T1190/) (Exploit Public-Facing Application), [T1203](https://attack.mitre.org/techniques/T1203/) (Exploitation for Client Execution)
**Trigger**: IDS/IPS alert, EDR detection, vulnerability scan, TI advisory, WAF block

### Exploit Lifecycle

```mermaid
graph LR
    Disc["ðŸ” Vuln Discovered"] --> PoC["ðŸ’» Public PoC"]
    PoC --> Wild["ðŸŒ In-the-Wild"]
    Wild --> Patch["ðŸ©¹ Vendor Patch"]
    Patch --> Apply["âœ… Patch Applied"]
    style Disc fill:#3498db,color:#fff
    style Wild fill:#e74c3c,color:#fff
    style Apply fill:#27ae60,color:#fff
```

### Virtual Patching Flow

```mermaid
sequenceDiagram
    participant SOC
    participant WAF
    participant Dev as Dev Team
    SOC->>WAF: Create virtual patch rule
    WAF-->>SOC: âœ… Rule active
    SOC->>Dev: Notify vulnerability + CVE
    Dev->>Dev: Fix source code
    Dev->>SOC: Deployed fix
    SOC->>WAF: Remove virtual patch
```

---

## Decision Flow

```mermaid
graph TD
    Alert["ðŸš¨ Exploit Attempt Detected"] --> CVE["ðŸ” Identify CVE"]
    CVE --> Vuln{"ðŸŽ¯ Is Target Vulnerable?"}
    Vuln -->|Patched / Not Affected| Attempt["ðŸŸ¡ Blocked Attempt"]
    Vuln -->|Vulnerable| Response{"ðŸ“Š Exploit Successful?"}
    Response -->|200 OK / Shell / Payload| Success["ðŸ”´ Successful Exploitation"]
    Response -->|Blocked (403/Drop)| Attempt
    Response -->|Error (500)| Partial["ðŸŸ  Investigate Further"]
    Attempt --> Block["ðŸš« Block Attacker IP"]
    Success --> Type{"ðŸ’¥ Exploit Impact?"}
    Type -->|RCE| RCE["ðŸš¨ Isolate + Major Response"]
    Type -->|Info Disclosure| Info["ðŸ›¡ï¸ Block + Patch"]
    Type -->|DoS| DoS["âš™ï¸ Mitigate + Patch"]
    Partial --> Type
    RCE --> FullIR["Full Incident Response"]
```

---

## 1. Analysis

### 1.1 CVE / Vulnerability Identification

| Check | How | Done |
|:---|:---|:---:|
| Identify CVE number from alert/signature | IPS/IDS/WAF | â˜ |
| Check CVSS score and severity | NVD, vendor advisory | â˜ |
| Is it in CISA KEV (Known Exploited Vulnerabilities)? | [CISA KEV](https://www.cisa.gov/known-exploited-vulnerabilities-catalog) | â˜ |
| Is public PoC exploit available? | GitHub, ExploitDB | â˜ |
| Check if active exploitation in the wild | TI feeds, advisories | â˜ |

### 1.2 Target Assessment

| Check | How | Done |
|:---|:---|:---:|
| Is the target system affected? (version/config) | CMDB, vulnerability scanner | â˜ |
| Is the vulnerable service exposed externally? | Firewall rules, Shodan | â˜ |
| What is the asset criticality? | CMDB, business context | â˜ |
| Is the target already patched? | Patch management system | â˜ |
| Were compensating controls in place? (WAF, segmentation) | Security architecture | â˜ |

### 1.3 Exploitation Evidence

| Evidence | What to Look For | Done |
|:---|:---|:---:|
| Network payload | Exploit signature in IPS/IDS logs | â˜ |
| Server response | Success indicators (reverse shell, data leak) | â˜ |
| Process creation | New processes spawned after exploit | â˜ |
| File creation | Web shells, payloads dropped to disk | â˜ |
| Outbound connections | C2 callbacks from exploited server | â˜ |
| Post-exploitation | Credential dumping, lateral movement | â˜ |

---

## 2. Containment

### 2.1 Exploit Attempt (Blocked)

| # | Action | Tool | Done |
|:---:|:---|:---|:---:|
| 1 | Block attacker IP | Firewall | â˜ |
| 2 | Update IPS/WAF signatures | IPS / WAF | â˜ |
| 3 | Alert vulnerability management to prioritize patching | Ticket | â˜ |

### 2.2 Successful Exploitation

| # | Action | Tool | Done |
|:---:|:---|:---|:---:|
| 1 | **Isolate exploited system** immediately | EDR / Firewall | â˜ |
| 2 | Block attacker IP and any C2 indicators | Firewall | â˜ |
| 3 | **Apply virtual patch** at WAF/IPS | WAF / IPS | â˜ |
| 4 | Disable vulnerable service if possible | System admin | â˜ |
| 5 | Capture memory dump and disk image | Forensics | â˜ |
| 6 | Check for lateral movement from exploited host | [PB-12](Lateral_Movement.en.md) | â˜ |

### 2.3 Zero-Day (No Patch Available)

| # | Action | Done |
|:---:|:---|:---:|
| 1 | Apply workaround from vendor advisory (disable feature, config change) | â˜ |
| 2 | Deploy custom WAF/IPS rule for exploit pattern | â˜ |
| 3 | Segment affected systems from network | â˜ |
| 4 | Enable enhanced monitoring / logging | â˜ |
| 5 | Report to vendor and request emergency patch | â˜ |

---

## 3. Eradication

| # | Action | Done |
|:---:|:---|:---:|
| 1 | **Apply official patch** from vendor | â˜ |
| 2 | Remove any web shells, backdoors, or dropped payloads | â˜ |
| 3 | Reset credentials on the exploited system | â˜ |
| 4 | Scan for other vulnerable instances in environment | â˜ |
| 5 | Check for persistence mechanisms installed by attacker | â˜ |

---

## 4. Recovery

| # | Action | Done |
|:---:|:---|:---:|
| 1 | Run vulnerability scan to confirm patch applied | â˜ |
| 2 | Test application functionality after patching | â˜ |
| 3 | Reconnect system to network in stages | â˜ |
| 4 | Monitor for re-exploitation attempts for 72 hours | â˜ |
| 5 | Update asset inventory with patch status | â˜ |

---

## 5. IoC Collection

| Type | Value | Source |
|:---|:---|:---|
| CVE Number | | IPS / Advisory |
| Attacker IP | | Firewall / IPS |
| Exploit Payload | | IPS / WAF logs |
| Target System | | Alert |
| Dropped Files (hash) | | EDR / Forensics |
| C2 Indicators | | Network logs |
| Post-exploitation Tools | | EDR |

---

## 6. Escalation Criteria

| Condition | Escalate To |
|:---|:---|
| RCE with confirmed shell | CISO + Major Incident |
| Zero-day (no patch available) | CISO + Vendor + CERT |
| Critical infrastructure (DB, DC) exploited | CISO immediately |
| CISA KEV vulnerability actively exploited | Vulnerability Management + SOC Lead |
| Multiple systems exploited | Major Incident |
| Data breach through exploitation | [PB-08](Data_Exfiltration.en.md) + Legal |

---

### Exploit Severity Classification

```mermaid
graph TD
    Vuln["ðŸ”“ Vulnerability"] --> CVSS{"ðŸ“Š CVSS?"}
    CVSS -->|9.0+| Critical["ðŸ”´ Critical â€” patch 24h"]
    CVSS -->|7.0-8.9| High["ðŸŸ  High â€” patch 7d"]
    CVSS -->|4.0-6.9| Medium["ðŸŸ¡ Medium â€” patch 30d"]
    CVSS -->|Under 4.0| Low["ðŸŸ¢ Low â€” next cycle"]
    Critical --> Weaponized{"âš”ï¸ Weaponized?"}
    Weaponized -->|Yes| Emergency["ðŸš¨ Emergency patch NOW"]
    Weaponized -->|No| Critical
    style Emergency fill:#c0392b,color:#fff
    style Critical fill:#e74c3c,color:#fff
```

### Virtual Patching Architecture

```mermaid
graph LR
    Traffic["ðŸŒ Traffic"] --> WAF["ðŸ›¡ï¸ WAF"]
    WAF --> VPatch["ðŸ“‹ Virtual Patch Rule"]
    VPatch -->|Match| Block["âŒ Block"]
    VPatch -->|No match| App["ðŸ“± App"]
    App --> IPS["ðŸ” IPS"]
    IPS -->|Signature| Alert["ðŸš¨ Alert"]
    style WAF fill:#27ae60,color:#fff
    style Block fill:#e74c3c,color:#fff
```

## Related Documents

- [IR Framework](../Framework.en.md)
- [Incident Report](../../templates/incident_report.en.md)
- [PB-10 Web Attack](Web_Attack.en.md)
- [PB-12 Lateral Movement](Lateral_Movement.en.md)
- [PB-13 C2 Communication](C2_Communication.en.md)

## References

- [MITRE ATT&CK T1190 â€” Exploit Public-Facing Application](https://attack.mitre.org/techniques/T1190/)
- [CISA Known Exploited Vulnerabilities Catalog](https://www.cisa.gov/known-exploited-vulnerabilities-catalog)
- [NVD â€” National Vulnerability Database](https://nvd.nist.gov/)
