# Playbook: ‡∏°‡∏±‡∏•‡πÅ‡∏ß‡∏£‡πå (Malware Infection)

**ID**: PB-03
**‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á**: ‡∏™‡∏π‡∏á | **‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà**: Endpoint Security
**MITRE ATT&CK**: [T1204](https://attack.mitre.org/techniques/T1204/) (User Execution), [T1059](https://attack.mitre.org/techniques/T1059/) (Command & Scripting Interpreter)
**‡∏ó‡∏£‡∏¥‡∏Å‡πÄ‡∏Å‡∏≠‡∏£‡πå**: EDR alert, AV detection, sandbox result, ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥

---

## ‡∏ú‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à

```mermaid
graph TD
    Alert["üö® Malware Alert"] --> Type{"ü¶† ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó?"}
    Type -->|Trojan/RAT| RAT["üïµÔ∏è Remote Access"]
    Type -->|Worm| Worm["üêõ Self-propagating"]
    Type -->|Ransomware| Ransom["üîí Encryption"]
    Type -->|Infostealer| Stealer["üîë Credential Theft"]
    Type -->|Dropper/Loader| Drop["üì• Second-stage"]
    RAT --> C2{"üì° C2 Callback?"}
    Worm --> Lateral{"üñ•Ô∏è ‡∏Å‡∏µ‡πà‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á?"}
    Ransom --> Escalate["üî¥ ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö PB-02"]
    Stealer --> Creds["üîê ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô Creds ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ"]
    C2 -->|‡πÉ‡∏ä‡πà| Isolate["üîí Isolate + Block C2"]
    C2 -->|‡πÑ‡∏°‡πà| Contain["üü† Contain + Clean"]
    Lateral -->|>3 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á| Major["üî¥ Major Incident"]
```

---

## 1. ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå

### 1.1 ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏°‡∏±‡∏•‡πÅ‡∏ß‡∏£‡πå

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó | ‡∏•‡∏±‡∏Å‡∏©‡∏ì‡∏∞ | ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏∏‡∏ô‡πÅ‡∏£‡∏á |
|:---|:---|:---|
| **Trojan/RAT** | Remote access, keylogger | üî¥ ‡∏™‡∏π‡∏á |
| **Worm** | Self-replicating, network spread | üî¥ ‡∏™‡∏π‡∏á |
| **Ransomware** | ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏´‡∏±‡∏™‡πÑ‡∏ü‡∏•‡πå, ransom note | üî¥ ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï |
| **Infostealer** | ‡∏Ç‡πÇ‡∏°‡∏¢ browser passwords, cookies | üî¥ ‡∏™‡∏π‡∏á |
| **Dropper/Loader** | ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î payload ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° | üü† ‡∏™‡∏π‡∏á |
| **Rootkit** | ‡∏ã‡πà‡∏≠‡∏ô process, kernel-level | üî¥ ‡∏ß‡∏¥‡∏Å‡∏§‡∏ï |
| **Cryptominer** | ‡πÉ‡∏ä‡πâ CPU/GPU mining | üü† ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á |

### 1.2 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö

| ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ | ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö | ‡πÄ‡∏™‡∏£‡πá‡∏à |
|:---|:---|:---:|
| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏°‡∏±‡∏•‡πÅ‡∏ß‡∏£‡πå | EDR classification | ‚òê |
| File hash (SHA256) | EDR | ‚òê |
| VT / TI lookup | VirusTotal, OTX | ‚òê |
| Entry vector (email/USB/download/exploit) | EDR timeline | ‚òê |
| Parent process chain | EDR process tree | ‚òê |
| ‡∏°‡∏µ C2 callback? | EDR network events | ‚òê |
| ‡∏°‡∏µ lateral movement? | SIEM correlation | ‚òê |
| ‡∏°‡∏µ persistence? (registry, scheduled task, service) | EDR / Autoruns | ‚òê |
| ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏≠‡∏≠‡∏Å? | DLP / Netflow | ‚òê |
| ‡∏°‡∏µ host ‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠? | SIEM IoC search | ‚òê |

---

### ‡∏ú‡∏±‡∏á‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏°‡∏±‡∏•‡πÅ‡∏ß‡∏£‡πå

```mermaid
graph LR
    Hash["#Ô∏è‚É£ Hash"] --> VT["üîç VirusTotal"]
    VT --> Known{"‚úÖ ‡∏£‡∏π‡πâ‡∏à‡∏±‡∏Å?"}
    Known -->|‡πÉ‡∏ä‡πà| Report["üìã ‡πÉ‡∏ä‡πâ TI report"]
    Known -->|‡πÑ‡∏°‡πà| Sandbox["üß™ Sandbox"]
    Sandbox --> Static["üìù Static Analysis"]
    Static --> Dynamic["‚ñ∂Ô∏è Dynamic Analysis"]
    Dynamic --> IOC["üéØ ‡∏™‡∏Å‡∏±‡∏î IoC"]
    style Hash fill:#3498db,color:#fff
    style Sandbox fill:#e74c3c,color:#fff
    style IOC fill:#27ae60,color:#fff
```

### ‡∏ú‡∏±‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°

```mermaid
sequenceDiagram
    participant EDR
    participant SOC
    participant FW as Firewall
    participant SIEM
    EDR->>SOC: üö® Malware detected
    SOC->>EDR: Isolate host
    SOC->>EDR: Block hash (org-wide)
    SOC->>FW: Block C2 IP/domain
    SOC->>SIEM: Sweep IOCs ‡∏ó‡∏±‡πâ‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£
    SIEM-->>SOC: ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå (additional hosts?)
```

---

## 2. ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°

| # | ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ | ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠ | ‡πÄ‡∏™‡∏£‡πá‡∏à |
|:---:|:---|:---|:---:|
| 1 | **Isolate** host ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (network quarantine) | EDR | ‚òê |
| 2 | **Kill** malicious process | EDR | ‚òê |
| 3 | **Block** file hash ‡∏ó‡∏±‡πâ‡∏á‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏£ | EDR policy | ‚òê |
| 4 | **Block** C2 domain/IP ‡∏ó‡∏µ‡πà proxy, firewall, DNS | All | ‚òê |
| 5 | **‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ IoC** (hash, IP, domain) ‡πÉ‡∏ô host ‡∏≠‡∏∑‡πà‡∏ô | SIEM | ‚òê |
| 6 | **‡∏ö‡∏•‡πá‡∏≠‡∏Å entry vector** (email attachment hash, URL) | Mail gateway | ‚òê |

---

## 3. ‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏à‡∏±‡∏î

| # | ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ | ‡πÄ‡∏™‡∏£‡πá‡∏à |
|:---:|:---|:---:|
| 1 | ‡∏•‡∏ö malware binary + dropped files | ‚òê |
| 2 | ‡∏•‡∏ö persistence ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (registry, task, service, cron) | ‚òê |
| 3 | ‡∏´‡∏°‡∏∏‡∏ô‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô credentials ‡∏ó‡∏µ‡πà‡∏≠‡∏≤‡∏à‡∏ñ‡∏π‡∏Å‡∏Ç‡πÇ‡∏°‡∏¢ | ‚òê |
| 4 | ‡∏´‡∏≤‡∏Å worm ‚Üí ‡∏ï‡∏£‡∏ß‡∏à‡∏ó‡∏∏‡∏Å host ‡πÉ‡∏ô segment | ‚òê |
| 5 | ‡∏´‡∏≤‡∏Å rootkit ‚Üí **rebuild ‡∏à‡∏≤‡∏Å clean image** (‡πÑ‡∏°‡πà clean ‡πÑ‡∏î‡πâ) | ‚òê |

---

## 4. ‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ü‡∏π

| # | ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ | ‡πÄ‡∏™‡∏£‡πá‡∏à |
|:---:|:---|:---:|
| 1 | Rebuild/restore host ‡∏à‡∏≤‡∏Å known-good image | ‚òê |
| 2 | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï EDR signatures + detection rules | ‚òê |
| 3 | ‡∏õ‡∏£‡∏±‡∏ö email gateway rules (block attachment types) | ‚òê |
| 4 | ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï firewall/proxy blocklists | ‚òê |
| 5 | ‡∏≠‡∏ö‡∏£‡∏°‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏´‡∏≤‡∏Å entry vector = phishing/download) | ‚òê |
| 6 | ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° 14 ‡∏ß‡∏±‡∏ô | ‚òê |

---

## 5. ‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏Å‡∏≤‡∏£‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö

| ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç | ‡∏¢‡∏Å‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á |
|:---|:---|
| **Ransomware** ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô | [PB-02 Ransomware](Ransomware.th.md) ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ |
| **C2 confirmed** | [PB-13 C2](C2_Communication.th.md) |
| **Worm** ‚Äî ‡∏´‡∏•‡∏≤‡∏¢ host ‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ | Major Incident |
| **Data exfiltration** | [PB-08 Data Exfil](Data_Exfiltration.th.md) + Legal |
| **Infostealer** ‚Äî credentials ‡∏ñ‡∏π‡∏Å‡∏Ç‡πÇ‡∏°‡∏¢ | [PB-05 Account Compromise](Account_Compromise.th.md) |
| **Server/DC** ‡∏ï‡∏¥‡∏î‡πÄ‡∏ä‡∏∑‡πâ‡∏≠ | CISO ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ |

---

### ‡∏ú‡∏±‡∏á Malware Analysis Pipeline

```mermaid
graph LR
    Sample["ü¶† Sample"] --> Static["üìã Static Analysis"]
    Static --> Sandbox["üèñÔ∏è Sandbox"]
    Sandbox --> IOC["üîç Extract IOCs"]
    IOC --> TI["üìä Threat Intel"]
    TI --> Block["üîí Block"]
    Block --> Hunt["üéØ Hunt across org"]
    style Sample fill:#e74c3c,color:#fff
    style Block fill:#27ae60,color:#fff
```

### ‡∏ú‡∏±‡∏á EDR Response Flow

```mermaid
sequenceDiagram
    participant EDR
    participant SOC
    participant Endpoint
    participant SIEM
    EDR->>SOC: üö® Malware detected
    SOC->>EDR: Isolate host
    EDR->>Endpoint: üîí Network isolated
    SOC->>EDR: Collect forensic data
    EDR-->>SOC: üìã Process tree + artifacts
    SOC->>SIEM: ‡πÄ‡∏û‡∏¥‡πà‡∏° IOCs ‡πÉ‡∏ô blocklist
```

## ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á

- [‡∏Å‡∏£‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå](../Framework.th.md)
- [‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå](../../templates/incident_report.th.md)
- [PB-02 Ransomware](Ransomware.th.md)
- [PB-13 C2 Communication](C2_Communication.th.md)

## ‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á

- [MITRE ATT&CK T1204 ‚Äî User Execution](https://attack.mitre.org/techniques/T1204/)
